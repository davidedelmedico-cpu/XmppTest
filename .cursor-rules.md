# Regole importanti per lo sviluppo

## Principio di Certezza - Agire solo con comprensione chiara

**FONDAMENTALE: Agire SOLO quando ho buona certezza che l'utente sappia cosa sto per fare.**

### Regole fondamentali:
- ✅ **Verificare sempre che l'utente abbia compreso le implicazioni delle modifiche**
- ✅ **Spiegare chiaramente COSA farò PRIMA di procedere**
- ✅ **Chiedere conferma quando le modifiche potrebbero avere effetti non ovvi**
- ✅ **Essere esplicito su file, funzioni e logiche che verranno modificati**
- ❌ **NON procedere se c'è ambiguità sulla richiesta dell'utente**
- ❌ **NON assumere che l'utente capisca tutti i dettagli tecnici**
- ❌ **NON fare modifiche significative senza spiegare prima il piano**

### Quando fermarsi e chiedere:
1. La richiesta è vaga o ambigua
2. Ci sono multiple interpretazioni possibili
3. Le modifiche potrebbero avere effetti collaterali non ovvi
4. Il contesto fornito dall'utente è insufficiente
5. C'è incertezza su quale approccio sia preferito dall'utente

### Cosa comunicare prima di agire:
1. Quali file verranno modificati
2. Quale logica/funzionalità verrà cambiata
3. Eventuali effetti collaterali prevedibili
4. Perché questa è la soluzione scelta
5. Eventuali alternative considerate

## Debug e Testing - NON chiedere all'utente

**IMPORTANTE: L'utente è normalmente da cellulare e non può fare debug dal browser.**

### Regole fondamentali:
- ❌ **NON chiedere mai all'utente di aprire la console del browser**
- ❌ **NON chiedere mai all'utente di controllare i log**
- ❌ **NON aggiungere console.log per debug e chiedere all'utente di testarli**
- ✅ **Analizzare il codice completamente per capire il problema**
- ✅ **Usare l'analisi statica del codice per trovare bug**
- ✅ **Verificare tutti i flussi logici senza bisogno di testing manuale**

### Cosa fare invece:
1. Leggere e analizzare tutto il codice coinvolto
2. Tracciare il flusso dei dati dall'inizio alla fine
3. Identificare tutti i punti dove potrebbero esserci problemi
4. Fare modifiche basate sull'analisi statica
5. Verificare con build e lint, non con testing manuale

## Revisione completa del codice - PRIMA di modificare

**IMPORTANTE: Revisionare COMPLETAMENTE il codice prima di fare qualsiasi modifica.**

### Regole fondamentali:
- ✅ **Leggere l'INTERO file che si sta per modificare, non solo le parti rilevanti**
- ✅ **Verificare TUTTE le dipendenze e i punti di utilizzo della funzione/classe/componente**
- ✅ **Capire il flusso completo e gli effetti collaterali delle modifiche**
- ✅ **Cercare pattern simili nel codebase per mantenere coerenza**
- ✅ **Verificare che le modifiche siano coerenti con il resto del codice**
- ✅ **Usare grep/search per trovare tutti i riferimenti prima di modificare**
- ✅ **Non fare modifiche senza avere certezza del contesto completo**

### Processo da seguire:
1. Leggere completamente il file target
2. Cercare tutti i riferimenti/usages della funzione/classe/componente
3. Capire il flusso completo (chi chiama cosa, quando, perché)
4. Verificare effetti collaterali e dipendenze
5. Solo DOPO fare le modifiche

## Build - SEMPRE dopo modifiche

**IMPORTANTE: Fare SEMPRE il build dopo aver fatto modifiche al codice.**

### Regola fondamentale:
- ✅ **SEMPRE eseguire `npm run build` nella directory `web-client` dopo ogni modifica**
- ✅ Verificare che il build completi senza errori prima di considerare il lavoro finito

## Database locale - SOLO SINCRONIZZAZIONE

**IMPORTANTE: Il database locale è SOLO una sincronizzazione dal server XMPP.**

### Regole fondamentali:
1. **NON modificare MAI il database locale direttamente**
2. **Il database locale si sincronizza DAL server, NON il contrario**
3. **Tutte le modifiche devono essere fatte tramite il server XMPP**
4. **Il database locale è solo una cache/sincronizzazione per performance**

### Cosa fare:
- ✅ Leggere dal database locale (per performance)
- ✅ Sincronizzare dal server al database locale
- ✅ Aggiornare il database locale quando arrivano dati dal server

### Cosa NON fare:
- ❌ Modificare direttamente il database locale
- ❌ Rimuovere dati dal database locale senza rimuoverli dal server
- ❌ Aggiungere dati al database locale senza sincronizzarli dal server
- ❌ Considerare il database locale come fonte di verità

### Esempio sbagliato:
```typescript
// SBAGLIATO - Non fare mai così
await removeConversation(jid) // Rimuove solo dal DB locale
```

### Esempio corretto:
```typescript
// CORRETTO - Modificare tramite server, poi sincronizzare
await client.removeFromServer(jid) // Rimuove dal server
await syncFromServer() // Sincronizza il DB locale dal server
```
