# Regole importanti per lo sviluppo

## Indice delle regole

1. **Metodo Analitico** - Approfondire e comprendere il problema (FONDAMENTALE)
2. **Principio di Certezza** - Agire solo con comprensione chiara (FONDAMENTALE)
3. **Revisione completa del codice** - PRIMA di modificare
4. **Debug e Testing** - NON chiedere all'utente
5. **Build** - SEMPRE dopo modifiche
6. **Database locale** - SOLO SINCRONIZZAZIONE

---

## Metodo Analitico - Approfondire e comprendere il problema

**FONDAMENTALE: Usare sempre il metodo più analitico possibile per capire DAVVERO il problema prima di agire.**

Questa è la regola più importante: ogni azione deve essere preceduta da un'analisi approfondita. Il metodo analitico si applica a tutte le altre regole e deve essere seguito SEMPRE.

### Regole fondamentali:
- ✅ **Analizzare il problema in profondità, non fermarsi alla superficie**
- ✅ **Tracciare il flusso completo dei dati e della logica**
- ✅ **Identificare la causa radice, non solo i sintomi**
- ✅ **Considerare tutti i casi edge e scenari possibili**
- ✅ **Verificare le ipotesi con analisi del codice, non con supposizioni**
- ✅ **Mappare tutte le dipendenze e interazioni**
- ✅ **Capire il "perché" dietro ogni comportamento, non solo il "cosa"**
- ❌ **NON saltare alle conclusioni senza analisi approfondita**
- ❌ **NON fare modifiche basate su ipotesi non verificate**

### Processo analitico da seguire:
1. **Definire chiaramente il problema**: Cosa non funziona? Qual è il comportamento atteso vs quello osservato?
2. **Raccogliere informazioni**: Leggere tutto il codice rilevante, tracciare i flussi, identificare i punti di interazione
3. **Formulare ipotesi**: Basate sui dati raccolti, non su supposizioni
4. **Verificare le ipotesi**: Analizzare il codice per confermare o smentire ogni ipotesi
5. **Identificare la causa radice**: Andare oltre i sintomi per trovare la vera causa
6. **Progettare la soluzione**: Solo dopo aver compreso completamente il problema
7. **Verificare la soluzione**: Assicurarsi che risolva la causa radice, non solo i sintomi

### Tecniche analitiche da usare:
- Tracciamento completo del flusso di esecuzione
- Analisi delle dipendenze (chi dipende da cosa)
- Analisi dei dati (da dove vengono, dove vanno, come cambiano)
- Analisi degli stati (quali stati esistono, quando cambiano, perché)
- Analisi degli effetti collaterali (cosa viene influenzato dalle modifiche)
- Confronto con pattern simili nel codebase
- Verifica della coerenza architetturale

### Integrazione con altre regole:
- **Con Principio di Certezza**: L'analisi approfondita garantisce che si agisca solo con comprensione chiara
- **Con Revisione completa**: Il metodo analitico include e va oltre la revisione completa del codice
- **Con Debug e Testing**: L'analisi statica sostituisce il debug manuale

---

## Principio di Certezza - Agire solo con comprensione chiara

**FONDAMENTALE: Agire SOLO quando ho buona certezza che l'utente abbia buona consapevolezza di quello che farò.**

### Regole fondamentali:
- ✅ **Verificare sempre che l'utente abbia compreso le implicazioni delle modifiche**
- ✅ **Spiegare chiaramente COSA farò PRIMA di procedere**
- ✅ **Chiedere conferma quando le modifiche potrebbero avere effetti non ovvi**
- ✅ **Essere esplicito su file, funzioni e logiche che verranno modificati**
- ❌ **NON procedere se c'è ambiguità sulla richiesta dell'utente**
- ❌ **NON assumere che l'utente capisca tutti i dettagli tecnici**
- ❌ **NON fare modifiche significative senza spiegare prima il piano**

### Quando fermarsi e chiedere:
1. La richiesta è vaga o ambigua
2. Ci sono multiple interpretazioni possibili
3. Le modifiche potrebbero avere effetti collaterali non ovvi
4. Il contesto fornito dall'utente è insufficiente
5. C'è incertezza su quale approccio sia preferito dall'utente

### Cosa comunicare prima di agire:
1. Quali file verranno modificati
2. Quale logica/funzionalità verrà cambiata
3. Eventuali effetti collaterali prevedibili
4. Perché questa è la soluzione scelta
5. Eventuali alternative considerate

## Revisione completa del codice - PRIMA di modificare

**IMPORTANTE: Revisionare COMPLETAMENTE il codice prima di fare qualsiasi modifica.**

Questa sezione implementa concretamente il Metodo Analitico per la revisione del codice.

### Regole fondamentali:
- ✅ **Leggere l'INTERO file che si sta per modificare, non solo le parti rilevanti**
- ✅ **Verificare TUTTE le dipendenze e i punti di utilizzo della funzione/classe/componente**
- ✅ **Capire il flusso completo e gli effetti collaterali delle modifiche**
- ✅ **Cercare pattern simili nel codebase per mantenere coerenza**
- ✅ **Verificare che le modifiche siano coerenti con il resto del codice**
- ✅ **Usare grep/search per trovare tutti i riferimenti prima di modificare**
- ✅ **Non fare modifiche senza avere certezza del contesto completo**

### Processo da seguire (applicazione del Metodo Analitico):
1. **Definire**: Quale codice devo modificare e perché?
2. **Raccogliere**: Leggere completamente il file target e tutti i file correlati
3. **Mappare**: Cercare tutti i riferimenti/usages della funzione/classe/componente
4. **Analizzare**: Capire il flusso completo (chi chiama cosa, quando, perché)
5. **Verificare**: Controllare effetti collaterali e dipendenze
6. **Progettare**: Solo DOPO aver compreso tutto, progettare le modifiche
7. **Implementare**: Fare le modifiche con piena consapevolezza del contesto

---

## Debug e Testing - NON chiedere all'utente

**IMPORTANTE: L'utente è normalmente da cellulare e non può fare debug dal browser.**

Questa sezione applica il Metodo Analitico al debugging: usare analisi statica invece di debug interattivo.

### Regole fondamentali:
- ❌ **NON chiedere mai all'utente di aprire la console del browser**
- ❌ **NON chiedere mai all'utente di controllare i log**
- ❌ **NON aggiungere console.log per debug e chiedere all'utente di testarli**
- ✅ **Analizzare il codice completamente per capire il problema** (Metodo Analitico)
- ✅ **Usare l'analisi statica del codice per trovare bug**
- ✅ **Verificare tutti i flussi logici senza bisogno di testing manuale**

### Processo di debug analitico (applicazione del Metodo Analitico):
1. **Definire il problema**: Cosa non funziona? Qual è il comportamento osservato?
2. **Raccogliere informazioni**: Leggere e analizzare tutto il codice coinvolto
3. **Tracciare il flusso**: Seguire il flusso dei dati dall'inizio alla fine
4. **Identificare i punti critici**: Trovare tutti i punti dove potrebbero esserci problemi
5. **Formulare ipotesi**: Basate sull'analisi, non su supposizioni
6. **Verificare le ipotesi**: Analizzare il codice per confermare o smentire
7. **Risolvere**: Fare modifiche basate sull'analisi statica, non su tentativi
8. **Verificare**: Usare build e lint per validare, non testing manuale

---

## Build - SEMPRE dopo modifiche

**IMPORTANTE: Fare SEMPRE il build dopo aver fatto modifiche al codice.**

Il build è parte integrante del Metodo Analitico: serve a verificare che le modifiche siano corrette prima di considerare il lavoro completato.

### Regola fondamentale:
- ✅ **SEMPRE eseguire `npm run build` nella directory `web-client` dopo ogni modifica**
- ✅ Verificare che il build completi senza errori prima di considerare il lavoro finito
- ✅ Il build è la verifica finale che le modifiche siano sintatticamente e logicamente corrette

### Quando eseguire il build:
- Dopo ogni modifica al codice
- Prima di considerare completato un task
- Come parte del processo di verifica del Metodo Analitico

## Database locale - SOLO SINCRONIZZAZIONE

**IMPORTANTE: Il database locale è SOLO una sincronizzazione dal server XMPP.**

### Regole fondamentali:
1. **NON modificare MAI il database locale direttamente**
2. **Il database locale si sincronizza DAL server, NON il contrario**
3. **Tutte le modifiche devono essere fatte tramite il server XMPP**
4. **Il database locale è solo una cache/sincronizzazione per performance**

### Cosa fare:
- ✅ Leggere dal database locale (per performance)
- ✅ Sincronizzare dal server al database locale
- ✅ Aggiornare il database locale quando arrivano dati dal server

### Cosa NON fare:
- ❌ Modificare direttamente il database locale
- ❌ Rimuovere dati dal database locale senza rimuoverli dal server
- ❌ Aggiungere dati al database locale senza sincronizzarli dal server
- ❌ Considerare il database locale come fonte di verità

### Esempio sbagliato:
```typescript
// SBAGLIATO - Non fare mai così
await removeConversation(jid) // Rimuove solo dal DB locale
```

### Esempio corretto:
```typescript
// CORRETTO - Modificare tramite server, poi sincronizzare
await client.removeFromServer(jid) // Rimuove dal server
await syncFromServer() // Sincronizza il DB locale dal server
```

---

## Riepilogo: Workflow completo

Quando si affronta un problema o una richiesta, seguire questo workflow che integra tutte le regole:

### 1. Metodo Analitico (FONDAMENTALE)
- Definire chiaramente il problema
- Raccogliere tutte le informazioni necessarie
- Tracciare flussi, dipendenze, stati
- Identificare la causa radice
- Formulare e verificare ipotesi

### 2. Principio di Certezza
- Assicurarsi di aver compreso completamente il problema
- Spiegare all'utente cosa si farà e perché
- Chiedere conferma se necessario

### 3. Revisione completa del codice
- Leggere completamente tutti i file coinvolti
- Mappare tutte le dipendenze e usages
- Capire il flusso completo

### 4. Progettare la soluzione
- Solo dopo aver compreso tutto
- Verificare coerenza con il codebase
- Considerare effetti collaterali

### 5. Implementare
- Fare le modifiche con piena consapevolezza
- Seguire i pattern del codebase

### 6. Verificare
- Eseguire il build
- Verificare lint
- Assicurarsi che la soluzione risolva la causa radice

### 7. Rispettare l'architettura
- Database locale: solo sincronizzazione dal server
- Non modificare direttamente il database locale
- Tutte le modifiche tramite server XMPP

**Ricorda: Il Metodo Analitico è la base di tutto. Ogni altra regola si applica attraverso il metodo analitico.**
